{% extends "dashboard/base.html" %}
{% block title %}Walk-in Booking{% endblock %}

{% block content %}
<div class="box token-card">
    <h2 class="title is-5">Walk-in Booking</h2>

    <div class="field">
        <label class="label">Doctor ID</label>
        <div class="control">
            <input id="doctor_id" class="input" type="number" />
        </div>
    </div>

    <div class="field">
        <label class="label">Patient name</label>
        <div class="control">
            <input id="patient_name" class="input" type="text" />
        </div>
    </div>

    <div class="field">
        <div class="control">
            <button id="book" class="button is-primary">Create Walk-in Token</button>
        </div>
    </div>

    <div id="out" style="margin-top:10px;"></div>
</div>

<script>
    document.getElementById('book').addEventListener('click', async () => {
        const doctor_id = Number(document.getElementById('doctor_id').value);
        const patient_name = document.getElementById('patient_name').value.trim();
        if (!doctor_id || !patient_name) return alert('doctor and patient name required');

        const resp = await fetch('/api/token_queue/walkin/', {
            method: 'POST',
            credentials: 'same-origin',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ doctor_id, patient_name })
        });

        if (!resp.ok) {
            const j = await resp.json().catch(() => ({ detail: 'Error' }));
            return alert('Failed: ' + (j.detail || JSON.stringify(j)));
        }
        const data = await resp.json();
        document.getElementById('out').innerText = `Created token #${data.token_number} for ${data.patient_name}. ETA ${data.eta}`;
    });
</script>
{% endblock %}